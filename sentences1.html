<!DOCTYPE html>
<html>
<style>

#header1 {
  height: 80px;
  width: 100%;
  display: block;
  margin-bottom: 30px;  
  overflow: hidden;
}

#m_container1{
  width: 100%;
  display: block;
  overflow: hidden;
}

.confblock {
  width: 150px;
  height: 50px;
  background: #e0fee6; //#25c94a;
  color: #555;
  float: left;
  text-align: center;  
  font-size: 33px;
  margin-top: 10px;
  margin-bottom: 10px;  
  margin-right: 15px;
  margin-left: 15px;
  padding-top: 5px;
  padding-bottom: 5px;    
  cursor: pointer;
  border-color: #2196F3;
  border: 2px solid;  
  display: inline;
}

.active2 {
  border-color: #2196F3;
  background: #25c94a;    
}


.dv1 {
  width: 45%;
  //height: 65px;
  height: 25mm;  
  color: #555;
  float: left;
  text-align: center;  
  font-size: 33px;
  margin-top: 10px;
  margin-bottom: 10px;  
  padding-top: 5px;
  padding-bottom: 5px;  
  cursor: pointer;
  border-color: black;
  border: 2px solid;  
}

.LangFrom {
  background: #d2dcfb;
  margin-right: 10px;
  margin-left: 0px;
  padding-right: 5px;
  padding-left: 5px;  
  display: block;
}

.LangTo {
  background: #d9d9d9; 
  margin-right: 0px;
  margin-left: 10px;
  padding-right: 5px;
  padding-left: 5px;
  display: block;  
}

.Null {
  background: #ffffff;
  color: #ffffff;
  cursor: auto;
  user-select: none; 
}


.active1 {
  border-color: #2196F3;
  background: #21f3d8;    
}

#textfrom1 {
  height: 80px;
  width: 100%;
  color: #555;
  float: left;  
  font-size: 33px;
  margin-top: 10px;  
  padding-top: 5px;
  padding-bottom: 5px;  
  cursor: pointer;
  border-color: black;
  border: 2px solid;    
  display: block;
  margin-bottom: 20px;  
  overflow: hidden;
}

.inputtext {  
  height: 50px;
  background: #e0fee6; 
  color: #555;
  float: left;
  text-align: center;  
  font-size: 33px;
  margin-top: 10px;
  margin-bottom: 10px;  
  margin-right: 5px;
  margin-left: 5px;
  padding-top: 5px;
  padding-bottom: 5px;    
  padding-right: 7px;
  padding-left: 7px;  
  cursor: pointer;
  border-color: #2196F3;
  border: 2px solid;  
  border-radius: 10px;
  display: inline;
}


.puzzleblock {  
  height: 50px;
  background: #e0fee6; 
  color: #555;
  float: left;
  text-align: center;  
  font-size: 33px;
  margin-top: 10px;
  margin-bottom: 10px;  
  margin-right: 15px;
  margin-left: 15px;
  padding-top: 5px;
  padding-bottom: 5px;    
  padding-right: 5px;
  padding-left: 5px;
  border-radius: 10px;  
  cursor: pointer;
  border-color: #2196F3;
  border: 2px solid;  
  display: inline;
}


#inputtextfrom1 {
  height: 160px;
  width: 100%;
  display: block;
  margin-bottom: 20px;  
  overflow: hidden;
}


#puzzletextfrom1 {
  height: 250px;
  width: 100%;
  display: block;
  margin-bottom: 20px;  
  overflow: hidden;
}





</style>
<body>

<div id="header1">

</div>

<div id="textfrom1">

</div>

<div id="inputtextfrom1">

</div>

<div id="puzzletextfrom1">

</div>


<div id="m_container1">
</div>

<script>

const UrlArrP1 = "https://nirslife.github.io/arr_sentences";
const UrlArrP2 = ".json";
let UrlArray1;


const cnfEngOnOff_id1 = "confEngOnOffid1"; // показывать англ слова

const cnfLessonNum_id1 = "confLessonNumid1"; // номер урока 


const blockdiv_id1 = "blockbutton1"; // контейнер позиций
const PartLenght = 7; // длина порции
let CountPart; // кол-во порций
let CurPart = 0; // текущая порция
let LastCountItem = 0; // кол-во оставщихся позиций 
let ListLesson; // весь массив слов загружаем из UrlArray1
let ModeLesson = 1; // режим урока 1 - показывать англ слова, 2 - не показывать англ слова

let CurSentences = 0; // текущая предложение

let LessonNum = 1; // номер массива/урока
const CountLessonNum = 1; // кол-во уроков

let prevSelLangFrom; // текущий выделенный блок/позиция 

MainLoadPage();



function InitUrlArray1() {
  UrlArray1 = UrlArrP1 + LessonNum + UrlArrP2;
  return UrlArray1; 
}

async function LoadArray() {
  const response = await fetch(InitUrlArray1());
  const array1 = await response.json();
  CallBackForInitLoadPage1(array1);
//  console.log(names);   
}

function InitLoadPage1() {  
  LoadArray();  
}

//перемешивание массива случайным образом
function MixArray(aObj) {  
  const rArr = []; 
  const vObj = {"arrw":[]};
  InitRandomArr(aObj.arrw.length, 0, rArr);
  for (i = 0; i < aObj.arrw.length; i++) {
    vObj.arrw[i] = aObj.arrw[rArr[i]];    
  } 
  return vObj;
}

function CallBackForInitLoadPage1(aArr){    
  ListLesson = MixArray(aArr);   // перемешиваем
  DisplayExercise(ListLesson,CurSentences);
//  AddItemToHtml(ListLesson); 
}


function MainLoadPage() {
  InitConfBlocks(); 
  InitLoadPage1();
}


function getRandomInt(max) {
  return Math.floor(Math.random() * max);
}

// перемешивание случайным образом массива индексов
// max - [0..max-1], incval- величина смещение индекса [0+incval..max+incval-1] = [0..max-1] + incval
// Arr1 - массив [0..max-1]
function InitRandomArr(max, incval, Arr1) {
  for (i = 0; i < max; i++) {
    Arr1[i] = i;     
  }
  let j; let a;
  for (i = max - 1; i >= 0; i--) {    
    j = getRandomInt(max - 1);  
	a = Arr1[i];
    Arr1[i] = Arr1[j];
	Arr1[j] = a;
  }  
  for (i = 0; i < max; i++) {    
    Arr1[i+incval] = Arr1[i]+incval; 
  }
}


function speak(text) {
  const message = new SpeechSynthesisUtterance();
  message.lang = "en-EN";
  message.text = text;
  message.rate = 1.0;
  window.speechSynthesis.speak(message)
}


function clickLangFrom(aNode)
{
  if (prevSelLangFrom) {
    prevSelLangFrom.className = "dv1 LangFrom";          
  }
  prevSelLangFrom = aNode;        
  aNode.className = "dv1 LangFrom active1";
  //speak(aNode.innerText);
  speak(aNode.getAttribute("atext"));
  //console.log(aNode.getAttribute("arrnum"));
}

function clickLangTo(aNode)
{
  if (prevSelLangFrom) {
    if (prevSelLangFrom.getAttribute("arrnum") == aNode.getAttribute("arrnum")){	  
      aNode.removeAttribute("onclick"); 
	  aNode.className = "dv1 LangTo Null";	  
	  prevSelLangFrom.removeAttribute("onclick");
	  prevSelLangFrom.className = "dv1 LangFrom Null";	  
	  prevSelLangFrom = 0;
	  LastCountItem = LastCountItem - 1;
      if (LastCountItem < 1){
	    CurPart = CurPart + 1;  
	    ReInitItem(); 
	  } 	   
	}
  }  
}

function ReInitItem(){   
  if (CurPart == CountPart){
    CurPart = 0;
  }
  const element = document.getElementById(blockdiv_id1);
  element.remove(); 
  AddItemToHtml(ListLesson); 
}


function clickEngOnOff(aNode){
  let str = aNode.className; 
  if(str.indexOf("active2") > 0){
    str = str.replaceAll("active2","");
	ModeLesson = 2;	
	aNode.className = str;
	aNode.innerText = "Off";
  }else{
    aNode.className = "confblock active2";
	aNode.innerText = "On";	
    ModeLesson = 1;	
  }	
  ReInitItem();
}

function clickLessonNum(aNode){
  
  LessonNum = LessonNum + 1;
  if (LessonNum > CountLessonNum){ LessonNum = 1;}
  
  const Elem1 = document.getElementById(cnfLessonNum_id1);
  Elem1.innerText = "Lesson#"+LessonNum; 
  
  const element = document.getElementById(blockdiv_id1);
  if (element){ element.remove(); }
  InitLoadPage2();
}


function InitConfBlocks(){
  const Elem1 = document.createElement("div");
  Elem1.id = cnfEngOnOff_id1;
  Elem1.className = "confblock";
  Elem1.innerText = "Off";
  ModeLesson = 2;
  const att1 = document.createAttribute("onclick");
  att1.value = "clickEngOnOff(this)";  
  Elem1.setAttributeNode(att1);          

  
  const Elem2 = document.createElement("div");
  Elem2.id = cnfLessonNum_id1;
  Elem2.className = "confblock";
  Elem2.innerText = "Lesson#"+LessonNum;   
  const att2 = document.createAttribute("onclick");
  att2.value = "clickLessonNum(this)";  
  Elem2.setAttributeNode(att2);          
//  const att3 = document.createAttribute("LessonNum");
//  att3.value = LessonNum;  
//  Elem2.setAttributeNode(att3);          

  document.getElementById("header1").appendChild(Elem2); 
  document.getElementById("header1").appendChild(Elem1);     
}

// разрезаем предложение по пробелам
function SliceSentence(aSenten){
  let str = aSenten;
  let s1;
  let i;  
  let j = 0;
  let arrsen = [];
  //str = str.replaceAll("}","");  
  while (str.length > 0) {
    i = str.indexOf(" ");
    if (i < 1){ i = str.length; }
    s1 = str.substr(0, i);
    str = str.slice(i+1, str.length);  
    arrsen[j] = s1.replaceAll(" ","");   // убираем пробелы
	j++;
  }   
  return arrsen;
}


function DisplayExercise(obj,Indx){    
  let EngArr; 
  let EngArrNei;
  let IndxNei = Indx;
  if (IndxNei >= obj.arrw.lenght){IndxNei = 0;}   
  EngArr = SliceSentence(obj.arrw[Indx].Eng);
  EngArrNei = SliceSentence(obj.arrw[IndxNei].Eng);
  
  for (i = 0; i < EngArr.length; i++) {    
    const InpBl = document.createElement("div");
    InpBl.innerText = EngArr[i];
    InpBl.className = "puzzleblock";    
	document.getElementById("puzzletextfrom1").appendChild(InpBl);    
  }

  for (i = 0; i < EngArr.length; i++) {    
    const InpIT = document.createElement("div");
    InpIT.innerText = EngArr[i];
    InpIT.className = "inputtext";    
	document.getElementById("inputtextfrom1").appendChild(InpIT);    
  }
  
  
  
  document.getElementById("textfrom1").innerText = obj.arrw[Indx].Rus; 
  
  
  const aToNode = document.createElement("div");
  aToNode.id = blockdiv_id1; 
  textfrom1
  for (i = 0; i < obj.arrw.length; i++) {  
    const LangFrom = document.createElement("div");
    LangFrom.innerText = obj.arrw[i].Eng;
    LangFrom.className = "dv1 LangFrom";
    aToNode.appendChild(LangFrom);      
   
    const LangTo = document.createElement("div");
    LangTo.innerText = obj.arrw[i].Rus;
    aToNode.appendChild(LangTo);        
  }
  document.getElementById("m_container1").appendChild(aToNode); 
  //aMainNode.appendChild(aToNode);
}   // end of function

</script>

</body>
</html>
