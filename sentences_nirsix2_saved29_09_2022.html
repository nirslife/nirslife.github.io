<!DOCTYPE html>
<html>
  <script src="./js/sentences_nirsix2_js/insets_sn2.js"></script>
  <script src="./js/sentences_nirsix2_js/main_sn2.js"></script>
  <script src="./js/sentences_nirsix2_js/object_sn2.js"></script>  
  <link rel="stylesheet" href="./css/sentences_nirsix2_css/sentences_nirsix2.css">
  <head>
    <title>sentences_nirsix2</title>
  </head>
<body>

<script>

const cnfLessonNum_id1 = "confLessonNumid1"; // номер урока 


const blockdiv_id1 = "blockbutton1"; // контейнер позиций
const PartLenght = 7; // длина порции
let CountPart; // кол-во порций
let CurPart = 0; // текущая порция
let LastCountItem = 0; // кол-во оставщихся позиций 
let ListLesson; // весь массив слов загружаем из UrlArray1
let ModeLesson = 1; // режим урока 1 - показывать англ слова, 2 - не показывать англ слова


const StepMix = 7; // перемешиваем не весь массив целиков, а порциями StepMix
const MaxMixWordsAdd = 7;
let CurSentences = 0; // текущее предложение
let LessonNum = 5; // номер массива/урока
const CountLessonNum = 5; // кол-во уроков

let prevSelLangFrom; // текущий выделенный блок/позиция 
const msgspeak = new SpeechSynthesisUtterance();

let pvoiceitemctrl; // кнопка настроек 

MainLoadPage();



function HTML_BODY_AppendChild() {

}




function InitUrlArray1() {
  UrlArray1 = UrlArrP1 + LessonNum + UrlArrP2;
  return UrlArray1; 
}

async function LoadArray() {
  const response = await fetch(InitUrlArray1());
  const array1 = await response.json();
  CallBackForInitLoadPage1(array1);
//  console.log(names);   
}

function InitLoadPage1() {  
  LoadArray();  
}


function CallBackForInitLoadPage1(aArr){    
  ListLesson = MixArray(aArr);   // перемешиваем
  DisplayExercise(ListLesson, CurSentences);  
}


function MainLoadPage() {
  InitConfBlocks(); 
  InitLoadPage1();
  AddFooterButton(); // кнопки внизу: "проверить" и "следующее"
}


/*
function getRandomInt(max) {
  return Math.floor(Math.random() * max);
}
*/



function speak(text, arate) {
//  const msgspeak = new SpeechSynthesisUtterance();
  msgspeak.lang = "en-EN";
  msgspeak.text = text;
  msgspeak.rate = arate;
  window.speechSynthesis.speak(msgspeak)
}


function clickLessonNum(aNode){
  
  LessonNum = LessonNum + 1;
  if (LessonNum > CountLessonNum){ LessonNum = 1;}
  const Elem1 = document.getElementById(cnfLessonNum_id1);
  Elem1.innerText = "Lesson#"+LessonNum; 
  InitLoadPage1();
}


function clickClearInput(aThis){
///******************************
///******************************
///******************************
///******************************
  InpNode = document.getElementById("div_inputtextfrom1");
  if (InpNode) {
    while (InpNode.firstChild) {
      clickInputtext(InpNode.firstChild);
    }
  }	
}


function InitConfBlocks(){  
  const Elem1 = document.createElement("div");  
  Elem1.className = "confblock";
  Elem1.innerText = "Стереть";   
  const att1 = document.createAttribute("onclick");
  att1.value = "clickClearInput(this)";  
  Elem1.setAttributeNode(att1);          

  const Elem2 = document.createElement("div");
  Elem2.id = cnfLessonNum_id1;
  Elem2.className = "confblock";
  Elem2.innerText = "Lesson#"+LessonNum;   
  const att2 = document.createAttribute("onclick");
  att2.value = "clickLessonNum(this)";  
  Elem2.setAttributeNode(att2);     
  
  const DivEl2 = document.createElement("div"); 
  DivEl2.className = "downctrlblock";  
  DivEl2.innerText = "V";
  const att3 = document.createAttribute(eventvalue); //onclick //ontouchstart
  att3.value = "clickButtondownctrlblock(this)";  
  DivEl2.setAttributeNode(att3); 

  pvoiceitemctrl = document.createElement("div"); 
  pvoiceitemctrl.className = "blockvoiceitemctrl";
  createitemctrlbutton(pvoiceitemctrl);

  document.getElementById("header1").appendChild(Elem1); 
  document.getElementById("header1").appendChild(Elem2); 
  document.getElementById("header1").appendChild(DivEl2);   
  document.getElementById("header1").appendChild(pvoiceitemctrl);
 // document.getElementById("header1").appendChild(Elem1);     
}

function clickButtondownctrlblock(athis) {
  if (athis.innerText == "V"){
    athis.innerText = "X";
    pvoiceitemctrl.style.display = "block";
  }else{
    athis.innerText = "V";
    pvoiceitemctrl.style.display = "none"; 
  }  
}

function createitemctrlbutton(apvoiceitemctrl) {   
  const DivEl1 = document.createElement("div");
  DivEl1.className = "confbuttctrl";
  DivEl1.innerText = "Delete";
  const DivEl2 = document.createElement("div");
  DivEl2.className = "confbuttctrl";
  DivEl2.innerText = "Delete OK";
  const DivEl3 = document.createElement("div");
  DivEl3.className = "confbuttctrl";
  DivEl3.innerText = "  -  ";
  const DivEl4 = document.createElement("div");
  DivEl4.className = "confbuttctrl";
  DivEl4.innerText = StepMix;
  const DivEl5 = document.createElement("div");
  DivEl5.className = "confbuttctrl";
  DivEl5.innerText = "  +  ";

  apvoiceitemctrl.appendChild(DivEl1);
  apvoiceitemctrl.appendChild(DivEl2);
  apvoiceitemctrl.appendChild(DivEl3);
  apvoiceitemctrl.appendChild(DivEl4);
  apvoiceitemctrl.appendChild(DivEl5);
}



// разрезаем предложение по пробелам
function SliceSentence(aSenten){
  let str = aSenten;
  let s1;
  let i;  
  let j = 0;
  let arrsen = [];
  //str = str.replaceAll("}","");  
  while (str.length > 0) {
    i = str.indexOf(" ");
    if (i < 1){ i = str.length; }
    s1 = str.substr(0, i);
    str = str.slice(i+1, str.length);  
    s1 = s1.replaceAll(" ","");   // убираем пробелы	
	if (s1.length == 1) {s1 = s1 + " ";} 
	arrsen[j] = s1;
	j++;
  }   
  return arrsen;
}

function NextSentenceOnClick() {
  CurSentences++;
  if (ListLesson.arrw.length == CurSentences){CurSentences = 0;}
//  const rNode1 = document.getElementById("div_puzzletextfrom1");
//  const rNode2 = document.getElementById("div_inputtextfrom1");
//  if (rNode1){rNode1.remove();}
//  if (rNode2){rNode2.remove();}
  DisplayExercise(ListLesson,CurSentences);
  const remNode = document.getElementById("div_verify_cont1"); 
  if (remNode){remNode.remove();}  
  document.getElementById("verify_cont1").className = "verify_def";  //verify_def
}

function TestSentOnClick() {  
  let inpstr = ""; 
  let srcstr = "";
  const myCollection = document.getElementsByClassName("inputtext");
  for (let i = 0; i < myCollection.length; i++) {
    //myCollection[i].style.color = "red";
	inpstr = inpstr + myCollection[i].innerHTML;
  }  
  inpstr = inpstr.replaceAll(" ","");
  inpstr = inpstr.toUpperCase();
  srcstr = ListLesson.arrw[CurSentences].Eng.replaceAll(" ","");
  srcstr = srcstr.toUpperCase();
  
  const remNode = document.getElementById("div_verify_cont1");
  if (remNode){remNode.remove();}
  
  const vrfNode = document.getElementById("verify_cont1");  
  const rootDiv = document.createElement("div");
  rootDiv.id = "div_verify_cont1";
  const bInfo = document.createElement("div");  
  bInfo.className = "verify_info";
  
  const EngSrcSen = document.createElement("div");  
  EngSrcSen.className = "verify_info";
  EngSrcSen.innerText = ListLesson.arrw[CurSentences].Eng;
  
  const EngSrc = document.createElement("div");  
  EngSrc.className = "verify_info";
  EngSrc.innerText = srcstr;
  const EngInp = document.createElement("div");  
  EngInp.className = "verify_info";
  EngInp.innerText = inpstr;
  if (inpstr == srcstr){
    vrfNode.className = "verify_green";   
    bInfo.innerText = "ХОРОШО!";  	  
  }
  else{
    vrfNode.className = "verify_red"; 
	bInfo.innerText = "НЕ ВЕРНО!";  	  
  }
//  rootDiv.appendChild(bInfo); 
  rootDiv.appendChild(EngSrcSen);  
  rootDiv.appendChild(EngSrc);
  rootDiv.appendChild(EngInp);    
  vrfNode.appendChild(rootDiv);  

  
}

function clickInputtext(aThis) {

  const InpBl = document.getElementById("Puzzid"+aThis.getAttribute("IndexArr"));  
  InpBl.className = "puzzleblock inpon";    
  //const att1 = document.createAttribute("onclick");
  const att1 = document.createAttribute(eventvalue);
  
  att1.value = "clickPuzzletext(this)";  
  InpBl.setAttributeNode(att1);        
  aThis.remove(); 

}

function clickPuzzletext(aThis) {
  
  //aThis.removeAttribute("onclick");
  aThis.removeAttribute(eventvalue);
  aThis.className = "inpoff puzzleblock";
  
  const InTxt = document.createElement("div");
  InTxt.innerText = aThis.innerText;
  InTxt.className = "inputtext";    
//  const att1 = document.createAttribute("onclick");// ontouchstart ontouchend
  const att1 = document.createAttribute(eventvalue);//   
  att1.value = "clickInputtext(this)";  
  InTxt.setAttributeNode(att1);             
  const att2 = document.createAttribute("IndexArr");
  att2.value = aThis.getAttribute("IndexArr");  
  InTxt.setAttributeNode(att2);   
  
  speak(aThis.innerText, 1.2);
  document.getElementById("div_inputtextfrom1").appendChild(InTxt);  
}


// формирование массива пазлов-слов (состоит из всех слов ответа и подмешиваем слова из соседнего предложения) 
// obj - обьект предложений,  
// Indx - индекс предложения
function FormArr_puzzletextfrom(obj,Indx){

  // IndxNei - индекс предложения для подмешивания слов
  let IndxNei = Indx + 1;   
  if (IndxNei >= obj.arrw.length){IndxNei = 0;}   

  // 
  let EngArrDbl = SliceSentence(obj.arrw[Indx].Eng); // разбивка англ. варианта пары
  let EngArrNei = SliceSentence(obj.arrw[IndxNei].Eng); // разбивка англ. из соседней пары для подмешивания 
  
  // добавляем к EngArrDbl массив EngArrNei
  let lnei = EngArrNei.length;
  let ldbl = EngArrDbl.lenght;
  if (lnei > MaxMixWordsAdd ){ lnei = MaxMixWordsAdd;} // добавляем не больше чем MaxMixWordsAdd-слов
  if (ldbl > 30){ lnei = 0; } // если слов больше 30 то не подмешиваем
  for (i = 0; i < lnei; i++) {
    EngArrDbl.push(EngArrNei[i]);    
  }	    
  
  return EngArrDbl;

}

// obj - обьект предложений,  
// Indx - индекс предложения
function DisplayExercise(obj,Indx){    

  // очищаем старое, если есть
  const rNode1 = document.getElementById("div_puzzletextfrom1");
  const rNode2 = document.getElementById("div_inputtextfrom1");
  if (rNode1){rNode1.remove();}
  if (rNode2){rNode2.remove();}


  
/*
  let EngArrDbl;
  let EngArrNei;  
  let IndxNei = Indx + 1;
  let t1 = obj.arrw.length;
  if (IndxNei >= t1){IndxNei = 0;}   
  EngArrDbl = SliceSentence(obj.arrw[Indx].Eng); // разбивка англ. варианта пары
  EngArrNei = SliceSentence(obj.arrw[IndxNei].Eng); // разбивка англ. из соседней пары для подмешивания 
  
  let LenSrc = EngArrDbl.lenght; // длина массива
  
  // добавляем к EngArrDbl массив EngArrNei
  t1 = EngArrNei.length;
  if (t1 > MaxMixWordsAdd ){ t1 = MaxMixWordsAdd;} // добавляем не больше чем MaxMixWordsAdd-слов
  if (LenSrc > 30){ t1 = 0; } // если слов больше 30 то не подмешиваем
  for (i = 0; i < t1; i++) {
    EngArrDbl.push(EngArrNei[i]);
    //EngArrDbl[j+i] = EngArrNei[i];	
  }	  
 */  
 
  let EngArrDbl = FormArr_puzzletextfrom(obj,Indx);    
  
  let MixArr = InitRandomArr3(EngArrDbl.length, StepMix);
  const rootDiv = document.createElement("div");
  rootDiv.id = "div_puzzletextfrom1";
  for (i = 0; i < EngArrDbl.length; i++) {    
    const InpBl = document.createElement("div");
    InpBl.innerText = EngArrDbl[MixArr[i]];
    InpBl.className = "puzzleblock inpon";    
    const att1 = document.createAttribute(eventvalue); //onclick //ontouchstart
    att1.value = "clickPuzzletext(this)";  
    InpBl.setAttributeNode(att1);        
    const att2 = document.createAttribute("IndexArr");
    att2.value = i;  
	InpBl.id = "Puzzid"+i;
    InpBl.setAttributeNode(att2);        		
	rootDiv.appendChild(InpBl);    
  }
  document.getElementById("puzzletextfrom1").appendChild(rootDiv); 
  
  const inpDiv = document.createElement("div");
  inpDiv.id = "div_inputtextfrom1";
  document.getElementById("inputtextfrom1").appendChild(inpDiv); 
  
  textR = document.getElementById("textfrom1");
  textR.innerText = obj.arrw[Indx].Rus; 
  const att3 = document.createAttribute("onmousedown"); //onclick //ontouchstart
  att3.value = "clickTextfrom(this)";  
  textR.setAttributeNode(att3);         

  document.getElementById("footerinfcount").innerText = Indx + " of " + obj.arrw.length;  
}   // end of function

function clickTextfrom(aThis) {
  let inpstr = ""; 
  const myCollection = document.getElementsByClassName("inputtext");
  for (let i = 0; i < myCollection.length; i++) {    
	inpstr = inpstr + " " + myCollection[i].innerHTML;
  }  

  speak(inpstr,0.8);
}

</script>

</body>
</html>
